(function(b){function c(p){this.node=p;this.items=[];this.seUp=new Audio("http://jsrun.it/assets/9/X/R/9/9XR9q.ogg");this.seDown=new Audio("http://jsrun.it/assets/2/L/1/L/2L1LS.ogg");this.seUp.autoplay=!1;this.seUp.loop=!1;this.seUp.volume=.6;this.seDown.autoplay=!1;this.seDown.loop=!1;this.seDown.volume=.6}function f(){this.node=document.importNode(document.getElementById("ranking-item").content,!0).firstElementChild;this._userId=this._order=0;this._userName="";this._score=0;this._displayOrder=!0;
this.moveState=this._shownOrder=0}function n(p){this.ranking=new c(document.querySelector(p))}var g=18,k=!1;requestAnimationFrame(function a(){k||(matchMedia("screen and (max-width: 600px)"),g=18,k=!0,setTimeout(function(){k=!1},100));requestAnimationFrame(a)});c.prototype.insert=function(a,e){var d=this;e-=0;a.order=e;this.items.splice(e-1,0,a);this.correctPosition();a.node.style.height=0;a.node.style.opacity=0;a.node.style.top=(g+2)*(e-1)+"mm";this.node.appendChild(a.node);setTimeout(function(){d.node.style.height=
(g+2)*d.items.length+2+"mm";a.node.style.height=g+"mm";a.node.style.opacity=1},0);return this};c.prototype.remove=function(a){this.items.splice(a.order-1,1);a.node.style.height=0;a.node.style.opacity=0;setTimeout(function(){a.node.parentNode&&a.node.parentNode.removeChild(a.node)},300);this.correctPosition();return this};c.prototype.move=function(a,e){var d=0,l=0,h=!1,m=this;e-=0;if(a.order===e)return this;a.order<e?(d=(g+2)*(a.order-1)+4,l=(g+2)*(e-1)-4,this.seDown.pause(),this.seDown.currentTime=
0,h=!0):(d=(g+2)*(a.order-1)-4,l=(g+2)*(e-1)+4,this.seUp.pause(),this.seUp.currentTime=0,h=!1);this.items.splice(a.order-1,1);this.items.splice(e-1,0,a);a.order=e;a.node.classList.add("ranking-item_moving");h?a.node.classList.add("ranking-item_movingDown"):a.node.classList.add("ranking-item_movingUp");a.node.style.top=d+"mm";a.node.style.zIndex=1E3;a.node.addEventListener("transitionend",function q(){a.node.removeEventListener("transitionend",q);a.node.style.top=l+"mm";setTimeout(function(){a.node.addEventListener("transitionend",
function r(){a.node.removeEventListener("transitionend",r);a.node.classList.remove("ranking-item_moving");a.node.classList.remove("ranking-item_movingDown");a.node.classList.remove("ranking-item_movingUp");m.correctPosition();setTimeout(function(){a.node.addEventListener("transitionend",function t(){a.node.removeEventListener("transitionend",t);a.node.style.zIndex="auto"})},0)})},0)});this.correctPosition();return this};c.prototype.correctPosition=function(){var a,e=this.items.length;for(a=0;a<e;++a){var d=
this.items[a];d.order=a+1;d.node.classList.contains("ranking-item_moving")||(d.node.style.height=g+"mm",d.node.style.top=(g+2)*a+"mm")}for(a=d=0;a<e;a++){var l=this.items[a-1],h=this.items[a+1],m=this.items[a];null==l?(d++,m.shownOrder=d,m.displayOrder=!0):m.displayOrder=l.score==m.score?!1:!0;null!=h&&(h.score!=m.score?(d++,h.shownOrder=d,h.displayOrder=!0):h.displayOrder=!1)}this.node.style.height=(g+2)*e+2+"mm"};Object.defineProperty(f.prototype,"order",{get:function(){return this._order},set:function(a){this._order=
a-0}});Object.defineProperty(f.prototype,"displayOrder",{get:function(){return this._displayOrder},set:function(a){a?this.node.querySelector(".ranking-item-order").textContent=this.shownOrder:this.node.querySelector(".ranking-item-order").textContent=""}});Object.defineProperty(f.prototype,"shownOrder",{get:function(){return this._shownOrder},set:function(a){this._shownOrder=a-=0;this.displayOrder?this.node.querySelector(".ranking-item-order").textContent=a:this.node.querySelector(".ranking-item-order").textContent=
""}});Object.defineProperty(f.prototype,"userId",{get:function(){return this._userId},set:function(a){this._userId=a;this.node.dataset.teamid=a}});Object.defineProperty(f.prototype,"userName",{get:function(){return this._userName},set:function(a){this._userName=a;this.node.querySelector(".ranking-item-userName").textContent=a}});Object.defineProperty(f.prototype,"score",{get:function(){return this._score},set:function(a){function e(){d<a?d+=Math.ceil((a-d)/10):a<d&&(d-=Math.ceil((d-a)/10));l.textContent=
d+"";d!==a&&requestAnimationFrame(e)}var d=this._score,l=this.node.querySelector(".ranking-item-score");this._score=a-=0;requestAnimationFrame(e)}});n.prototype.start=function(){return this};n.prototype.fetchRanking=function(){var a=new XMLHttpRequest;a.open("GET","/api/ranking");return new Promise(function(e,d){a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return d(a);e(JSON.parse(a.responseText))}};a.send()})};b.RankingItem=f;b.RankingApp=n})(this);var app;
window.addEventListener("DOMContentLoaded",function(){app=(new RankingApp("#live-leaderboard")).start()});var counttimer=null;function sortScores(){allScoresArray=[];for(var b in allScores)allScoresArray.push(allScores[b]);allScoresArray.sort(function(c,f){return c.score<f.score?1:f.score<c.score?-1:c.username<f.username?1:f.username<c.username?-1:0});for(b=0;b<allScoresArray.length;b++)allScores[allScoresArray[b].userid]=allScoresArray[b]}var applyScoresCounter=null;
function addPlayerToGame(b){clearTimeout(applyScoresCounter);if(!$("#live-leaderboard div[data-teamid='"+b.userid+"']").length){var c=new RankingItem;c.userId=b.userid;c.userName=b.username;c.score=0;app.ranking.insert(c,app.ranking.items.length+1);allScores[b.userid]=c}null!=seenGameData&&null!=seenGameData.connectedusers&&null!=seenGameData.connectedusers[b.userid]&&null!=seenGameData.connectedusers[b.userid].player&&seenGameData.connectedusers[b.userid].player&&null!=seenGameData.connectedusers[b.userid].online&&
seenGameData.connectedusers[b.userid].online&&($("#mc-teamsanswered tr[data-teamid='"+b.userid+"']").length||$("#mc-teamsanswered").append('<tr data-teamid="'+b.userid+'"><td colspan="2" data-fieldname="username">'+b.username+'</td><td class="status text-right"><span class="badge badge-secondary" id="mc-teamsanswered-'+b.userid+'-status">Waiting</span></td></tr>'));applyScoresCounter=setTimeout(function(){applyPlayerScores()},100)}
function applyPlayerScores(){var b=[];if(null!=seenGameData.leaderboard)for(var c in seenGameData.leaderboard){var f=seenGameData.leaderboard[c],n="";null!=seenGameData.allusers[c]&&null!=seenGameData.allusers[c].username&&(n=seenGameData.allusers[c].username);b.push({userid:c,score:f,username:n})}console.log(b);b.sort(function(g,k){return g.score<k.score?1:k.score<g.score?-1:g.username<k.username?1:k.username<g.username?-1:0});for(c=0;c<b.length;c++)f=b[c],allScores[f.userid].score=f.score,app.ranking.move(allScores[f.userid],
c+1)}function removePlayerFromGame(b){$("#mc-teamsanswered").find("[data-teamid='"+b+"']").remove()};