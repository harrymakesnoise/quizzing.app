var cropper,imageData;function setImageData(a){imageData=a}function previewImage(){URL.revokeObjectURL(renderSrc);renderSrc=window.URL.createObjectURL($("#profilePictureInput")[0].files[0]);$(".image-preview").attr("src",renderSrc)}
function updateProfilePicture(){canvas=cropper.getCroppedCanvas({width:160,height:160});canvas.toBlob(function(a){url=URL.createObjectURL(a);var b=new FileReader;b.readAsDataURL(a);b.onloadend=function(){$.ajax({type:"POST",dataType:"json",url:"/api/user/update",data:{image:b.result,userid:thisUserId},success:function(c){resetSaveImgBtn();"error"==c.type?alert(c.message):($(".profile-img-container img").attr("src",c.url),$(".image-preview").attr("src",c.url),$("#modal-image-edit").modal("hide"),$(".profile-img-container button[data-target='#modal-image-delete']").show(),
$("#edit-image-imageeditor-tab").parent().show(),$("#edit-image-upload-tab").parent().removeClass("col-12").addClass("col-6"))}})}})}
function saveImageChanges(){if(""==renderSrc)return!1;$("#modal-image-edit").data("bs.modal")._config.backdrop="static";$("#modal-image-edit").data("bs.modal")._config.keyboard=!1;$("#modal-image-edit [data-dismiss]").fadeOut();$("#image-edit-save-btn").css("width",$("#image-edit-save-btn").outerWidth()+"px").html('<i class="fa fa-spin fa-spinner"></i>');var a=new FormData;if("upload"==$("#edit-image-mode").val())setImageData($("#profilePictureInput")[0].files[0]);else return updateProfilePicture(),
!1;a.append("image",imageData);a.append("userid",thisUserId);$.ajax({url:"/api/user/"+$("#edit-image-mode").val(),data:a,processData:!1,contentType:!1,type:"POST",success:function(b){resetSaveImgBtn();"error"==b.type?alert(b.message):($(".profile-img-container img").attr("src",b.url),$(".image-preview").attr("src",b.url),$("#modal-image-edit").modal("hide"),$(".profile-img-container button[data-target='#modal-image-delete']").show(),$("#edit-image-imageeditor-tab").parent().show(),$("#edit-image-upload-tab").parent().removeClass("col-12").addClass("col-6"))}})}
function clearProfilePicture(){$("#modal-image-delete").data("bs.modal")._config.backdrop="static";$("#modal-image-delete").data("bs.modal")._config.keyboard=!1;$("#modal-image-delete [data-dismiss]").fadeOut();$("#image-delete-btn").css("width",$("#image-delete-btn").outerWidth()+"px").html('<i class="fa fa-spin fa-spinner"></i>');$.ajax({url:"/api/user/delete",data:"",processData:!1,contentType:!1,type:"GET",success:function(a){resetSaveImgBtn();"error"==a.type?alert(a.message):($(".profile-img-container img").attr("src",
a.url),$(".image-preview").attr("src",a.url),$("#modal-image-delete").modal("hide"),$(".profile-img-container button[data-target='#modal-image-delete']").hide(),$("#edit-image-imageeditor-tab").parent().hide(),$("#edit-image-upload-tab").click().parent().removeClass("col-6").addClass("col-12"))}})}
function resetSaveImgBtn(){"undefined"!==typeof $("#modal-image-delete").data("bs.modal")&&($("#modal-image-delete").data("bs.modal")._config.backdrop=!0,$("#modal-image-delete").data("bs.modal")._config.keyboard=!0,$("#modal-image-delete [data-dismiss]").fadeIn(),$("#image-delete-btn").css("width","auto").html("Confirm"));"undefined"!==typeof $("#modal-image-edit").data("bs.modal")&&($("#modal-image-edit").data("bs.modal")._config.backdrop=!0,$("#modal-image-edit").data("bs.modal")._config.keyboard=
!0,$("#modal-image-edit [data-dismiss]").fadeIn(),$("#image-edit-save-btn").css("width","auto").html("Save Changes"));cropper.destroy();cropper=new Cropper($("#image-edit-image")[0],{autocrop:!1,minCanvasWidth:"100%"})}$(document).ready(function(){$("#image-edit-save-btn").click(saveImageChanges);$("#image-delete-btn").click(clearProfilePicture);cropper=new Cropper($("#image-edit-image")[0],{autocrop:!1,minCanvasWidth:"100%"})});