var isSendingMessage=!1,lastChatMsgObj={},lastSentMsg="",notifyNewChats=!0,newMessageCount=0,seenChatMsgs=[],sfxChat=new Audio("/siteassets/chat-message.mp3");sfxChat.autoplay=!1;sfxChat.loop=!1;sfxChat.muted=!0;sfxChat.volume=.6;
function addPlayerToChat(a){var c=$("#qc-contactlist li[data-teamid='"+a.userid+"']"),e=a.username,d=a.avatarurl,b=e,f=".player-list";if(null!=a.banned||null!=a.muted)b+='<small class="contacts-list-date float-right btn-group">',null!=a.muted&&a.muted&&(b+='<label class="btn btn-sm btn-warning">MUTED</label>'),null!=a.banned&&a.banned&&(b+='<label class="btn btn-sm btn-danger">BANNED</label>'),null!=a.player&&(a.player?b+='<label class="btn btn-sm btn-info">PLAYER</label>':(b+='<label class="btn btn-sm btn-primary">QUIZMASTER</label>',
f=".admin-list")),b+="</small>";var g=null!=a.online&&a.online?"Online":"Offline";$("[data-teamid='"+a.userid+"'] [data-fieldname='username']").html(e);$("[data-teamid='"+a.userid+"'] [data-fieldname='avatar']").attr("src","/siteassets/user-images/"+d);c.length?(c.find(".contacts-list-img").attr("src","/siteassets/user-images/"+d),c.find(".contacts-list-name").html(b),c.find(".contacts-list-online").html(g)):$("#qc-contactlist "+f).append('<li data-teamid="'+a.userid+'"><a href="" onClick="return false;"><img class="contacts-list-img" data-fieldname="avatar" src="/siteassets/user-images/'+
d+'"><div class="contacts-list-info"><span class="contacts-list-name" data-fieldname="username">'+b+'</span><span class="contacts-list-online">'+g+"</span></div>\x3c!-- /.contacts-list-info --\x3e</a></li>")}
function receiveMessage(a){null!=a.data&&(a=a.data);if(0<=seenChatMsgs.indexOf(a.chatid))return!1;seenChatMsgs.push(a.chatid);var c=new Date(a.time),e=convert12Hrs(c.getHours()),d=!1;if(null!=lastChatMsgObj.userid&&lastChatMsgObj.userid==a.userid&&null!=lastChatMsgObj.time){var b=new Date(lastChatMsgObj.time);b.setMinutes(b.getMinutes()+2);b>=c&&(d=!0)}var f=seenGameData.allusers[a.userid],g=f.username;f=f.avatarurl;e=c.getDate()+" "+monthToDesc(c.getMonth())+" / "+e.hour+":"+c.getMinutes()+e.ampm;
var k=a.avatar="";c=!1;a.userid==userid&&(k=" right",lastSentMsg=a.message,c=!0,$("#mc-chatmessagebox").val(""),setTimeout(function(){isSendingMessage=!1},2E3));if(d){var h=$("#mc-chatbox .direct-chat-msg[data-teamid='"+a.userid+"']");if(0>=h.length)d=!1;else if(b=h.last().find(".direct-chat-text"),0>=b.length)d=!1;else{b=new Date(b.first().data("msgtime"));var l=new Date(a.time);b.setMinutes(b.getMinutes()+2);b>=l?h.last().append('<div class="direct-chat-text" data-msgid="'+a.chatid+'" data-msgtime="'+
a.time+'">'+a.message+"</div>"):d=!1}}d||(d='<div class="direct-chat-msg'+k+'" data-teamid="'+a.userid+'"><div class="direct-chat-infos clearfix"><span class="direct-chat-name float-left" data-fieldname="username">'+g+'</span><span class="direct-chat-timestamp float-right">'+e+'</span></div>\x3c!-- /.direct-chat-infos --\x3e<img class="direct-chat-img" data-fieldname="avatar" src="/siteassets/user-images/'+f+'" alt="'+g+'">\x3c!-- /.direct-chat-img --\x3e<div class="direct-chat-text" data-msgid="'+
a.chatid+'" data-msgtime="'+a.time+'">'+a.message+"</div>\x3c!-- /.direct-chat-text --\x3e</div>\x3c!-- /.direct-chat-msg --\x3e",$("#mc-chatbox").append(d));lastChatMsgObj=a;$("#mc-chatbox").scrollTop($("#mc-chatbox").prop("scrollHeight"));$("#mc-chatbox .direct-chat-text").click(function(){"function"===typeof window.adminChatCmds&&adminChatCmds($(this).data("msgid"),$(this).parent().data("teamid"),$(this).parent().find(".direct-chat-name").text())});c||(sfxChat.pause(),sfxChat.currentTime=0,notifyNewChats&&
(newMessageCount++,a=newMessageCount.toString()+" new message"+(1!=newMessageCount?"s":""),$(".direct-chat .card-tools span").html(newMessageCount.toString()).attr("title",a).fadeIn(),$(".direct-chat .card-tools span").tooltip("dispose").tooltip()),setTimeout(function(){},10))}function convert12Hrs(a){var c="am";a=parseInt(a);0==a?a="12":12<a&&(a-=12,c="pm");return{hour:a,ampm:c}}
function monthToDesc(a){a=parseInt(a);if(0==a)return"Jan";if(1==a)return"Feb";if(2==a)return"Mar";if(3==a)return"Apr";if(4==a)return"May";if(5==a)return"Jun";if(6==a)return"Jul";if(7==a)return"Aug";if(8==a)return"Sep";if(9==a)return"Oct";if(10==a||11==a)return"Nov"}
function sendMessage(){if(isSendingMessage)return!1;isSendingMessage=!0;var a=$("#mc-chatmessagebox").val();a=a.replace(!1,"");if(lastSentMsg==a)return!1;0<a.length&&(quizPackets.push({type:"chat-message",data:a,callback:"sendmessage_cb"}),sendToServer())}
function removeMessage(a){console.log(a);null!=a.chatid&&null!=a.userid&&(a=$("#mc-chatbox .direct-chat-msg[data-teamid='"+a.userid+"']").find(".direct-chat-text[data-msgid='"+a.chatid+"']"),1==a.parent().find(".direct-chat-text").length?a.parent().remove():a.remove())}
$(document).ready(function(){$("#mc-sendchatmessage").on("click",function(){sendMessage()});$("#mc-chatmessagebox").on("keydown",function(a){13==a.which&&sendMessage()});$('[data-toggle="tooltip"]').tooltip();$(".direct-chat").on("click focus",function(){$(".direct-chat .card-tools span").fadeOut();notifyNewChats=!1});$(".direct-chat").on("focusout",function(){newMessageCount=0;notifyNewChats=!0})});